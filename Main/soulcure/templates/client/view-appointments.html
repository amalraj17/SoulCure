{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Soulcure</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Free HTML Templates" name="keywords" />
    <meta content="Free HTML Templates" name="description" />

    <!-- Favicon -->
    <link href="{% static 'img/favicon.ico' %}" rel="icon" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet" />

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Libraries Stylesheet -->
    <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet" />
    <link href="{% static 'lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css' %}" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />
    <!-- data table links start -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <style>
        *,
        *:focus,
        *:active {
            outline: none;
            outline-offset: 0;
            outline-color: red;
            font-family: 'Poppins', sans-serif;
        }

        select {
            border: 2px solid #4b9123;
            min-width: 5em;
            border-radius: 3px;
        }

        .dataTables_filter label {
            font-size: 17px;
        }

        div.dataTables_wrapper div.dataTables_filter input[type=search] {
            height: 2.5em;
            width: 25em;
            border: 2px solid #4b9123;
            border-radius: 3px;
            padding: 0 10px;
            font-size: 14px;
        }

        .table.dataTable.table-striped>tbody>tr>* {
            border: none;
        }

        .table.dataTable.table-striped>tbody>tr.odd>* {
            box-shadow: none;
            background-color: #dbeed098;
        }

        .table.dataTable.table-striped>tbody>tr.even>* {
            box-shadow: none;
            background-color: #7ebd5a98;
        }

        .table.dataTable.table-striped>tbody>tr.odd:hover {
            background-color: #f2c64d67;
        }

        .cheight {
            height: 100vh;
        }

        .table-responsive {
            margin: 20px;
        }



        .table thead {
            margin-bottom: 10px;
        }

        .view-app-row {
            height: 40px;
            margin-bottom: 7%;
            margin-top: 3%;


        }

        .view-app-col {
            margin-left: .1%;
            margin-right: .1%;
            font-size: 30px;
            font-weight: bold;
            border: 2px solid black;
            transition: all 0.3s;
        }

        .view-app-coll {
            margin-left: 6%;
            margin-right: .1%;
            font-size: 30px;
            font-weight: bold;
            border: 2px solid black;
            transition: all 0.3s;
        }

        .view-app-coll:hover {
            background-color: #920d0d8e;
        }

        .view-app-col:hover {
            background-color: #920d0d8e;
        }

        .active-button {
            background-color: green;
            /* Change this to your desired active color */
            color: white;
            /* Change this to your desired text color */
        }

        .inactive-button {
            background-color: lightgray;
            /* Change this to your desired inactive color */
            color: black;
            /* Change this to your desired text color */
        }
    </style>


</head>

<body>
    <!-- Topbar Start -->

    <!-- Navbar Start -->
    <div class="container-fluid sticky-top bg-white shadow-sm">
        <div class="container">
            <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 ">
                <a href="index.html" class="navbar-brand">
                    <h1 class="m-0  text-success">
                        <i class="fa-solid fa-hand-holding-hand fa-flip-horizontal"></i>SoulCure
                    </h1>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>


                {% if user.is_authenticated %}
                <div class="collapse navbar-collapse ms-5 mr-5 justify-content-end" id="navbarCollapse">
                    <div class="navbar-nav ms-5 mr-5 py-0 justify-content-end">
                        <a href="{% url 'index' %}" class="nav-item nav-link active">Home</a>
                        <a href="{% url 'listtherapist' %}" class="nav-item nav-link">Find a Therapist</a>
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Services</a>
                            <div class="dropdown-menu m-0">
                                <a href="{% url 'familytherapy' %}" class="dropdown-item">Family Therapy</a>
                                {% comment %} <a href="{% url 'search' %}" class="dropdown-item">Search</a>
                                <a href="appointment.html" class="dropdown-item">Appointment</a> {% endcomment %}
                            </div>
                        </div>
                        <a href="{% url 'about' %}" class="nav-item nav-link">About Us</a>

                        {% comment %} <a href="contact.html" class="nav-item nav-link">Contact</a> {% endcomment %}
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle"
                                data-bs-toggle="dropdown">Welcome,{{user.name}}</a>
                            <div class="dropdown-menu m-0">
                                <a href="{% url 'profile' %}" class="dropdown-item nav-linkd">My Profile</a>
                                <a href="{% url 'view-appointment-client' %}" class="dropdown-item nav-linkd">View
                                    Appointments</a>
                                <a href="{% url 'logout' %}" class="dropdown-item nav-linkd ">Logout</a>
                            </div>
                        </div>

                    </div>
                </div>

                {% else %}
                <div class="collapse navbar-collapse ms-5 mr-5 justify-content-between" id="navbarCollapse">
                    <div class="navbar-nav ms-5 mr-5 py-0 justify-content-end">


                        <a href="{% url 'index' %}" class="nav-item nav-link active">Home</a>
                        <a href="{% url 'about' %}" class="nav-item nav-link">About</a>
                        <a href="{% url 'listtherapist' %}" class="nav-item nav-link">Find a Therapist</a>
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Services</a>
                            <div class="dropdown-menu m-0">
                                <a href="{% url 'familytherapy' %}" class="dropdown-item">Family Therapy</a>
                                {% comment %} <a href="{% url 'search' %}" class="dropdown-item">Search</a>
                                <a href="appointment.html" class="dropdown-item">Appointment</a> {% endcomment %}
                            </div>
                        </div>
                        {% comment %} <a href="contact.html" class="nav-item nav-link">Contact</a> {% endcomment %}
                        {% comment %} <a href="contact.html" class="nav-item nav-link">Contact</a> {% endcomment %}

                    </div>

                    <div class="d-flex">
                        <a href="{% url 'login' %}" class="nav-item nav-link btn btn-success mx-2 text-dark">Login</a>

                        <!-- Register button -->
                        <a href="{% url 'register' %}" class="nav-item nav-link btn btn-success text-dark">Register</a>
                    </div>
                    {% endif %}
                </div>
            </nav>
        </div>
    </div>
    <!-- Navbar End -->

    <div class="container cheight">
        <div class="container-fluid mt-5">
            <h1 class="text-center">Your Appointments</h1>

            <div class="row view-app-row">
                <div class="col-lg-3 btn text-center view-app-coll bg-light text-success active-button" id="completed-button" data-filter="completed">
                    Completed
                </div>
                <div class="col-lg-3 btn text-center view-app-coll bg-light text-success inactive-button" id="upcoming-button" data-filter="upcoming">
                    Upcoming
                </div>
                
            </div>
            <div class="table-responsive">
                <table id="example" class="table rounded text-center table-hover table-bordered">
                    

                    <thead class="thead fw-bold bg-success text-dark text-center">
                        <tr>
                            <th>Sl_No</th>
                            <th>Therapist</th>
                            <th>Appointment Date</th>
                            <th>Time Slot</th>
                            <th>Status</th>
                            <th class="action-columns">Cancel Appointment</th>
                        </tr>
                    </thead>
                    <tbody id="appointment-table-body" class="text-dark">
                        {% for appointment in appointments %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ appointment.therapist.name }}</td>
                            <td>{{ appointment.date }}</td>
                            <td>{{ appointment.get_time_slot_display }}</td>
                            <td>{{ appointment.get_status_display }}</td>
                            <td>
                                {% if appointment.status != 'Canceled' %}
                                <button class="btn btn-danger cancel-appointment"
                                    data-appointment-id="{{ appointment.id }}">Cancel</button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    
                </table>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        new DataTable('#example');

        document.querySelector('div.dataTables_wrapper div.dataTables_filter input').setAttribute('placeholder', 'Search anything')
    </script>



    <script>
        $(document).ready(function() {
            console.log("Document is ready!");
            // Function to load appointments based on status
            function loadAppointments(status) {
                $.ajax({
                    url: '{% url "fetch_appointments_clients" %}',
                    data: {'status': status},
                    dataType: 'json',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    success: function(data) {
                        // Clear existing table rows
                        $('#appointment-table-body').empty();
    
                        // Determine whether to show the "Cancel Appointment" column
                        var showCancelColumn = (status === 'upcoming');
    
                        // Populate the table with new data
                        data.appointments.forEach(function(appointment) {
                            var row = '<tr>' +
                                '<td>' + appointment.sl_no + '</td>' +
                                '<td>' + appointment.therapist + '</td>' +
                                '<td>' + appointment.appointment_date + '</td>' +
                                '<td>' + appointment.time_slot + '</td>' +
                                '<td>' + appointment.status + '</td>';
    
                            // Add the "Cancel Appointment" button if needed
                            if (showCancelColumn) {
                                row += '<td>' +
                                    '<button class="btn btn-danger cancel-appointment" ' +
                                    'data-appointment-id="' + appointment.sl_no + '">Cancel</button>' +
                                    '</td>';
                            }
    
                            row += '</tr>';
                            $('#appointment-table-body').append(row);
                            btnCancel=$(".cancel-appointment");
                            console.log(btnCancel)
                            btnCancel.on('click',function (e) {
                                e.stopPropagation()
                                console.log("Cancel appointment button clicked!");
                                console.log('fn called')
                
                                var appointmentId = $(this).data("appointment-id");
                
                                // Display a confirmation dialog
                                var confirmation = confirm("Are you sure you want to cancel this appointment?");
                
                                if (confirmation) {
                                    // User clicked "OK," send an AJAX request to cancel the appointment
                                    $.ajax({
                                        type: "POST",
                                        url: "{% url 'cancel-appointment' %}",
                                        data: {
                                            csrfmiddlewaretoken: '{{ csrf_token }}',  // Include the CSRF token
                                            appointment_id: appointmentId
                                        },
                                        dataType: "json",
                                        success: function (data) {
                                            if (data.success) {
                                                // Reload the page dynamically upon successful cancellation
                                                location.reload();
                                            } else {
                                                location.reload();
                                            }
                                        },
                                        error: function (xhr, status, error) {
                                            console.error(xhr.responseText);
                                            alert("An error occurred while processing your request.");
                                        },
                                    });
                                }
                            });
                        });
    
                        // Show/hide the "Cancel Appointment" column based on the condition
                        if (showCancelColumn) {
                            $('.action-columns').show();
                        } else {
                            $('.action-columns').hide();
                        }
                    }

                });
            }
    
            // Function to change button colors
            function changeButtonColors(clickedButton) {
                $('.view-app-coll').removeClass('active-button').addClass('inactive-button');
                $(clickedButton).removeClass('inactive-button').addClass('active-button');
            }
    
            $('#completed-button').click(function() {
                console.log('Completed button clicked');
                changeButtonColors(this);
                loadAppointments('completed');
            });
    
            $('#upcoming-button').click(function() {
                console.log('upcoming button clicked');
                changeButtonColors(this);
                loadAppointments('upcoming');
            });
    
            // Initial load with "Upcoming" appointments
            loadAppointments('upcoming');




        });
    </script>
    
    
    {% comment %} <!-- Include this script in your template -->
    <script>
        $(document).ready(function () {
            console.log('fn called')
            // Add an event listener to the cancel appointment buttons
            $(".cancel-appointment").click(function () {
                var appointmentId = $(this).data("appointment-id");

                // Display a confirmation dialog
                var confirmation = confirm("Are you sure you want to cancel this appointment?");

                if (confirmation) {
                    // User clicked "OK," send an AJAX request to cancel the appointment
                    $.ajax({
                        type: "POST",
                        url: "{% url 'cancel-appointment' %}",
                        data: {
                            csrfmiddlewaretoken: '{{ csrf_token }}',  // Include the CSRF token
                            appointment_id: appointmentId
                        },
                        dataType: "json",
                        success: function (data) {
                            if (data.success) {
                                // Reload the page dynamically upon successful cancellation
                                location.reload();
                            } else {
                                alert("Failed to cancel appointment. Please try again later.");
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error(xhr.responseText);
                            alert("An error occurred while processing your request.");
                        },
                    });
                }
            });
        });
    </script> {% endcomment %}



    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light mt-5 py-5">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h4 class="d-inline-block text-success text-uppercase border-bottom border-5 border-secondary mb-4">
                        Get In Touch
                    </h4>
                    <p class="mb-4">
                        No dolore ipsum accusam no lorem. Invidunt sed clita kasd clita et
                        et dolor sed dolor
                    </p>
                    <p class="mb-2">
                        <i class="fa fa-map-marker-alt text-success me-3"></i>123 Street,
                        New York, USA
                    </p>
                    <p class="mb-2">
                        <i class="fa fa-envelope text-success me-3"></i>info@example.com
                    </p>
                    <p class="mb-0">
                        <i class="fa fa-phone-alt text-success me-3"></i>+012 345 67890
                    </p>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="d-inline-block text-success text-uppercase border-bottom border-5 border-secondary mb-4">
                        Quick Links
                    </h4>
                    <div class="d-flex flex-column justify-content-start">
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Home</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>About Us</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Our Services</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Meet The Team</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Latest Blog</a>
                        <a class="text-light" href="#"><i class="fa fa-angle-right me-2"></i>Contact Us</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="d-inline-block text-success text-uppercase border-bottom border-5 border-secondary mb-4">
                        Popular Links
                    </h4>
                    <div class="d-flex flex-column justify-content-start">
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Home</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>About Us</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Our Services</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Meet The Team</a>
                        <a class="text-light mb-2" href="#"><i class="fa fa-angle-right me-2"></i>Latest Blog</a>
                        <a class="text-light" href="#"><i class="fa fa-angle-right me-2"></i>Contact Us</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="d-inline-block text-success text-uppercase border-bottom border-5 border-secondary mb-4">
                        Newsletter
                    </h4>
                    <form action="">
                        <div class="input-group">
                            <input type="text" class="form-control p-3 border-0" placeholder="Your Email Address" />
                            <button class="btn btn-success">Sign Up</button>
                        </div>
                    </form>
                    <h6 class="text-success text-uppercase mt-4 mb-3">Follow Us</h6>
                    <div class="d-flex">
                        <a class="btn btn-lg btn-success btn-lg-square rounded-circle me-2" href="#"><i
                                class="fab fa-twitter"></i></a>
                        <a class="btn btn-lg btn-success btn-lg-square rounded-circle me-2" href="#"><i
                                class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-lg btn-success btn-lg-square rounded-circle me-2" href="#"><i
                                class="fab fa-linkedin-in"></i></a>
                        <a class="btn btn-lg btn-success btn-lg-square rounded-circle" href="#"><i
                                class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid bg-dark text-light border-top border-secondary py-4">
        <div class="container">
            <div class="row g-5">
                <div class="col-md-6 text-center text-md-start">
                    <p class="mb-md-0">
                        &copy; <a class="text-success" href="#">Your Site Name</a>. All
                        Rights Reserved.
                    </p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0">
                        Designed by
                        <a class="text-success" href="https://htmlcodex.com">HTML Codex</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-success btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
    <script src="{% static 'lib/tempusdominus/js/moment.min.js' %}"></script>
    <script src="{% static 'lib/tempusdominus/js/moment-timezone.min.js' %}"></script>
    <script src="{% static 'lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js' %}"></script>

    <!-- Template Javascript -->
    <script src="{% static 'js/main.js' %}"></script>
</body>

</html>